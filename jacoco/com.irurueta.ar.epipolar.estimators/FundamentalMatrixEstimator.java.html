<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>FundamentalMatrixEstimator.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">com.irurueta:irurueta-ar</a> &gt; <a href="index.source.html" class="el_package">com.irurueta.ar.epipolar.estimators</a> &gt; <span class="el_source">FundamentalMatrixEstimator.java</span></div><h1>FundamentalMatrixEstimator.java</h1><pre class="source lang-java linenums">/*
 * Copyright (C) 2015 Alberto Irurueta Carro (alberto@irurueta.com)
 *
 * Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *         http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
package com.irurueta.ar.epipolar.estimators;

import com.irurueta.ar.epipolar.FundamentalMatrix;
import com.irurueta.geometry.Point2D;
import com.irurueta.geometry.estimators.LockedException;
import com.irurueta.geometry.estimators.NotReadyException;

import java.util.List;

/**
 * Base class for a non-robust fundamental matrix estimator.
 */
public abstract class FundamentalMatrixEstimator {

    /**
     * Default method for non-robust fundamental matrix estimation.
     */
<span class="fc" id="L33">    public static final FundamentalMatrixEstimatorMethod DEFAULT_METHOD =</span>
            FundamentalMatrixEstimatorMethod.SEVEN_POINTS_ALGORITHM;

    /**
     * Listener to be notified of events generated by this fundamental matrix
     * estimator.
     */
    protected FundamentalMatrixEstimatorListener listener;

    /**
     * List of 2D points corresponding to left view.
     */
    protected List&lt;Point2D&gt; leftPoints;

    /**
     * List of 2D points corresponding to right view.
     */
    protected List&lt;Point2D&gt; rightPoints;

    /**
     * Indicates whether this instance is locked because estimation is being
     * computed.
     */
    protected boolean locked;

    /**
     * Constructor.
     */
<span class="fc" id="L61">    protected FundamentalMatrixEstimator() {</span>
<span class="fc" id="L62">    }</span>

    /**
     * Constructor with matched 2D points.
     *
     * @param leftPoints  2D points on left view.
     * @param rightPoints 2D points on right view.
     * @throws IllegalArgumentException if provided list of points do not
     *                                  have the same length.
     */
<span class="fc" id="L72">    protected FundamentalMatrixEstimator(final List&lt;Point2D&gt; leftPoints, final List&lt;Point2D&gt; rightPoints) {</span>
<span class="fc" id="L73">        internalSetPoints(leftPoints, rightPoints);</span>
<span class="fc" id="L74">    }</span>

    /**
     * Returns matched 2D points on left view.
     *
     * @return 2D points on left view.
     */
    public List&lt;Point2D&gt; getLeftPoints() {
<span class="fc" id="L82">        return leftPoints;</span>
    }

    /**
     * Returns matched 2D points on right view.
     *
     * @return 2D points on right view.
     */
    public List&lt;Point2D&gt; getRightPoints() {
<span class="fc" id="L91">        return rightPoints;</span>
    }

    /**
     * Sets matched 2D points on both left and right views.
     *
     * @param leftPoints  matched 2D points on left view.
     * @param rightPoints matched 2D points on right view.
     * @throws LockedException          if this fundamental matrix estimator is locked.
     * @throws IllegalArgumentException if provided matched points on left and
     *                                  right views do not have the same length.
     */
    public void setPoints(final List&lt;Point2D&gt; leftPoints, final List&lt;Point2D&gt; rightPoints) throws LockedException {
<span class="fc bfc" id="L104" title="All 2 branches covered.">        if (isLocked()) {</span>
<span class="fc" id="L105">            throw new LockedException();</span>
        }

<span class="fc" id="L108">        internalSetPoints(leftPoints, rightPoints);</span>
<span class="fc" id="L109">    }</span>

    /**
     * Returns listener to be notified of events generated by this fundamental
     * matrix estimator.
     *
     * @return listener to be notified of events generated by this fundamental
     * matrix estimator.
     */
    public FundamentalMatrixEstimatorListener getListener() {
<span class="fc" id="L119">        return listener;</span>
    }

    /**
     * Sets listener to be notified of events generated by this fundamental
     * matrix estimator.
     *
     * @param listener listener to be notified of events generated by this
     *                 fundamental matrix estimator.
     * @throws LockedException if this estimator is locked.
     */
    public void setListener(final FundamentalMatrixEstimatorListener listener) throws LockedException {
<span class="fc bfc" id="L131" title="All 2 branches covered.">        if (isLocked()) {</span>
<span class="fc" id="L132">            throw new LockedException();</span>
        }

<span class="fc" id="L135">        this.listener = listener;</span>
<span class="fc" id="L136">    }</span>

    /**
     * Returns boolean indicating if estimator is locked because estimation is
     * under progress.
     *
     * @return true if estimator is locked, false otherwise.
     */
    public boolean isLocked() {
<span class="fc" id="L145">        return locked;</span>
    }

    /**
     * Returns boolean indicating whether estimator is ready to start the
     * fundamental matrix estimation.
     * This is true when the required number of matched points is provided to
     * obtain a solution.
     *
     * @return true if estimator is ready to start the fundamental matrix
     * estimation, false otherwise.
     */
    public abstract boolean isReady();

    /**
     * Estimates a fundamental matrix using provided lists of matched points on
     * left and right views.
     *
     * @return a fundamental matrix.
     * @throws LockedException                     if estimator is locked doing an estimation.
     * @throws NotReadyException                   if estimator is not ready because required
     *                                             input points have not already been provided.
     * @throws FundamentalMatrixEstimatorException if configuration of provided
     *                                             2D points is degenerate and fundamental matrix
     *                                             estimation fails.
     */
    public abstract FundamentalMatrix estimate() throws LockedException, NotReadyException,
            FundamentalMatrixEstimatorException;

    /**
     * Returns method of non-robust fundamental matrix estimator.
     *
     * @return method of fundamental matrix estimator.
     */
    public abstract FundamentalMatrixEstimatorMethod getMethod();

    /**
     * Returns minimum number of matched pair of points required to start
     * the estimation.
     *
     * @return minimum number of matched pair of points required to start
     * the estimation.
     */
    public abstract int getMinRequiredPoints();

    /**
     * Creates an instance of a fundamental matrix estimator using provided
     * method.
     *
     * @param method a fundamental matrix estimator method.
     * @return an instance of a fundamental matrix estimator.
     */
    public static FundamentalMatrixEstimator create(final FundamentalMatrixEstimatorMethod method) {
<span class="fc bfc" id="L198" title="All 3 branches covered.">        return switch (method) {</span>
<span class="fc" id="L199">            case AFFINE_ALGORITHM -&gt; new AffineFundamentalMatrixEstimator();</span>
<span class="fc" id="L200">            case EIGHT_POINTS_ALGORITHM -&gt; new EightPointsFundamentalMatrixEstimator();</span>
<span class="fc" id="L201">            default -&gt; new SevenPointsFundamentalMatrixEstimator();</span>
        };
    }

    /**
     * Creates an instance of a fundamental matrix estimator using provided
     * matched 2D points on left and right views and provided method.
     *
     * @param leftPoints  matched 2D points on left view.
     * @param rightPoints matched 2D points on right view.
     * @param method      a fundamental matrix estimator method.
     * @return an instance of a fundamental matrix estimator.
     * @throws IllegalArgumentException if provided list of points do not
     *                                  have the same length.
     */
    public static FundamentalMatrixEstimator create(
            final List&lt;Point2D&gt; leftPoints, final List&lt;Point2D&gt; rightPoints,
            final FundamentalMatrixEstimatorMethod method) {
<span class="fc bfc" id="L219" title="All 3 branches covered.">        return switch (method) {</span>
<span class="fc" id="L220">            case AFFINE_ALGORITHM -&gt; new AffineFundamentalMatrixEstimator(leftPoints, rightPoints);</span>
<span class="fc" id="L221">            case EIGHT_POINTS_ALGORITHM -&gt; new EightPointsFundamentalMatrixEstimator(leftPoints, rightPoints);</span>
<span class="fc" id="L222">            default -&gt; new SevenPointsFundamentalMatrixEstimator(leftPoints, rightPoints);</span>
        };
    }

    /**
     * Creates an instance of a fundamental matrix estimator using default
     * method.
     *
     * @return an instance of a fundamental matrix estimator.
     */
    public static FundamentalMatrixEstimator create() {
<span class="fc" id="L233">        return create(DEFAULT_METHOD);</span>
    }

    /**
     * Creates an instance of a fundamental matrix estimator using provided
     * matched 2D points on left and right views and default method.
     *
     * @param leftPoints  matched 2D points on left view.
     * @param rightPoints matched 2D points on right view.
     * @return an instance of a fundamental matrix estimator.
     * @throws IllegalArgumentException if provided list of points do not
     *                                  have the same length.
     */
    public static FundamentalMatrixEstimator create(final List&lt;Point2D&gt; leftPoints, final List&lt;Point2D&gt; rightPoints) {
<span class="fc" id="L247">        return create(leftPoints, rightPoints, DEFAULT_METHOD);</span>
    }

    /**
     * Sets matched 2D points on left and right views.
     * This method does not check whether instance is locked or not.
     *
     * @param leftPoints  matched 2D points on left view.
     * @param rightPoints matched 2D points on right view.
     * @throws IllegalArgumentException if provided lists of points don't have
     *                                  the same size.
     */
    private void internalSetPoints(final List&lt;Point2D&gt; leftPoints, final List&lt;Point2D&gt; rightPoints) {
<span class="fc bfc" id="L260" title="All 2 branches covered.">        if (leftPoints.size() != rightPoints.size()) {</span>
<span class="fc" id="L261">            throw new IllegalArgumentException();</span>
        }

<span class="fc" id="L264">        this.leftPoints = leftPoints;</span>
<span class="fc" id="L265">        this.rightPoints = rightPoints;</span>
<span class="fc" id="L266">    }</span>
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.13.202504020838</span></div></body></html>