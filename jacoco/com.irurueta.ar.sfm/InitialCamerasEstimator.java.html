<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>InitialCamerasEstimator.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">com.irurueta:irurueta-ar</a> &gt; <a href="index.source.html" class="el_package">com.irurueta.ar.sfm</a> &gt; <span class="el_source">InitialCamerasEstimator.java</span></div><h1>InitialCamerasEstimator.java</h1><pre class="source lang-java linenums">/*
 * Copyright (C) 2017 Alberto Irurueta Carro (alberto@irurueta.com)
 *
 * Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *         http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
package com.irurueta.ar.sfm;

import com.irurueta.ar.epipolar.FundamentalMatrix;
import com.irurueta.geometry.PinholeCamera;
import com.irurueta.geometry.estimators.LockedException;
import com.irurueta.geometry.estimators.NotReadyException;

/**
 * Estimates initial cameras to initialize geometry in a metric stratum.
 * This class uses provided fundamental matrix in order to obtain a pair of
 * cameras and upgrade such cameras into a metric stratum.
 * This class assumes that principal point of intrinsic camera parameters are
 * located at the origin of coordinates, and also that skewness of such
 * intrinsic parameters is zero.
 * This class can upgrade cameras to a metric stratum by either estimating the
 * Dual Absolute Quadric and its corresponding projective to metric
 * transformation, or by solving the Kruppa equations to estimate the Dual
 * Image of Absolute Conic to determine intrinsic parameters and then compute
 * the essential matrix and use 2D point matches to triangulate them and find
 * the initial cameras.
 */
@SuppressWarnings(&quot;DuplicatedCode&quot;)
public abstract class InitialCamerasEstimator {

    /**
     * Default method.
     */
<span class="fc" id="L43">    public static final InitialCamerasEstimatorMethod DEFAULT_METHOD =</span>
            InitialCamerasEstimatorMethod.DUAL_ABSOLUTE_QUADRIC;

    /**
     * Fundamental matrix relating two views whose cameras need to be estimated.
     */
    protected FundamentalMatrix fundamentalMatrix;

    /**
     * Indicates if this estimator is locked or not.
     */
    protected boolean locked;

    /**
     * Estimated camera for left view.
     */
    protected PinholeCamera estimatedLeftCamera;

    /**
     * Estimated camera for right view.
     */
    protected PinholeCamera estimatedRightCamera;

    /**
     * Listener to handle events raised by this instance.
     */
    protected InitialCamerasEstimatorListener listener;

    /**
     * Constructor.
     */
<span class="fc" id="L74">    protected InitialCamerasEstimator() {</span>
<span class="fc" id="L75">    }</span>

    /**
     * Constructor.
     *
     * @param fundamentalMatrix fundamental matrix relating two views.
     */
<span class="fc" id="L82">    protected InitialCamerasEstimator(final FundamentalMatrix fundamentalMatrix) {</span>
<span class="fc" id="L83">        this.fundamentalMatrix = fundamentalMatrix;</span>
<span class="fc" id="L84">    }</span>

    /**
     * Constructor.
     *
     * @param listener listener to handle events raised by this instance.
     */
<span class="fc" id="L91">    protected InitialCamerasEstimator(final InitialCamerasEstimatorListener listener) {</span>
<span class="fc" id="L92">        this.listener = listener;</span>
<span class="fc" id="L93">    }</span>

    /**
     * Constructor.
     *
     * @param fundamentalMatrix fundamental matrix relating two views.
     * @param listener          listener to handle events raised by this instance.
     */
    protected InitialCamerasEstimator(final FundamentalMatrix fundamentalMatrix,
<span class="fc" id="L102">                                      final InitialCamerasEstimatorListener listener) {</span>
<span class="fc" id="L103">        this.fundamentalMatrix = fundamentalMatrix;</span>
<span class="fc" id="L104">        this.listener = listener;</span>
<span class="fc" id="L105">    }</span>

    /**
     * Gets fundamental matrix relating two views whose cameras need to be
     * estimated.
     *
     * @return fundamental matrix relating two views.
     */
    public FundamentalMatrix getFundamentalMatrix() {
<span class="fc" id="L114">        return fundamentalMatrix;</span>
    }

    /**
     * Sets fundamental matrix relating two views whose cameras need to be
     * estimated.
     *
     * @param fundamentalMatrix fundamental matrix relating two views.
     * @throws LockedException if estimator is locked.
     */
    public void setFundamentalMatrix(final FundamentalMatrix fundamentalMatrix) throws LockedException {
<span class="fc bfc" id="L125" title="All 2 branches covered.">        if (isLocked()) {</span>
<span class="fc" id="L126">            throw new LockedException();</span>
        }
<span class="fc" id="L128">        this.fundamentalMatrix = fundamentalMatrix;</span>
<span class="fc" id="L129">    }</span>

    /**
     * Gets listener to handle events raised by this instance.
     *
     * @return listener to handle events raised by this instance.
     */
    public InitialCamerasEstimatorListener getListener() {
<span class="fc" id="L137">        return listener;</span>
    }

    /**
     * Sets listener to handle events raised by this instance.
     *
     * @param listener listener to handle events raised by this instance.
     */
    public void setListener(final InitialCamerasEstimatorListener listener) {
<span class="fc" id="L146">        this.listener = listener;</span>
<span class="fc" id="L147">    }</span>

    /**
     * Indicates if this estimator is locked or not.
     *
     * @return true if this estimator is locked, false otherwise.
     */
    public boolean isLocked() {
<span class="fc" id="L155">        return locked;</span>
    }

    /**
     * Gets estimated camera for left view.
     *
     * @return estimated camera for left view.
     */
    public PinholeCamera getEstimatedLeftCamera() {
<span class="fc" id="L164">        return estimatedLeftCamera;</span>
    }

    /**
     * Gets estimated camera for right view.
     *
     * @return estimated camera for right view.
     */
    public PinholeCamera getEstimatedRightCamera() {
<span class="fc" id="L173">        return estimatedRightCamera;</span>
    }

    /**
     * Returns method used by this estimator.
     *
     * @return method used by this estimator.
     */
    public abstract InitialCamerasEstimatorMethod getMethod();

    /**
     * Indicates if estimator is ready.
     *
     * @return true if estimator is ready, false otherwise.
     */
    public abstract boolean isReady();

    /**
     * Estimates cameras.
     *
     * @throws LockedException                         if estimator is locked.
     * @throws NotReadyException                       if estimator is not ready.
     * @throws InitialCamerasEstimationFailedException if estimation of cameras
     *                                                 fails for some reason, typically due to numerical
     *                                                 instabilities.
     */
    public abstract void estimate() throws LockedException, NotReadyException, InitialCamerasEstimationFailedException;

    /**
     * Creates an instance of an initial cameras estimator using provided
     * method.
     *
     * @param method method to estimate initial cameras.
     * @return an estimator.
     */
    public static InitialCamerasEstimator create(final InitialCamerasEstimatorMethod method) {
<span class="fc bfc" id="L209" title="All 3 branches covered.">        return switch (method) {</span>
<span class="fc" id="L210">            case ESSENTIAL_MATRIX -&gt; new EssentialMatrixInitialCamerasEstimator();</span>
<span class="fc" id="L211">            case DUAL_IMAGE_OF_ABSOLUTE_CONIC -&gt; new DualImageOfAbsoluteConicInitialCamerasEstimator();</span>
<span class="fc" id="L212">            default -&gt; new DualAbsoluteQuadricInitialCamerasEstimator();</span>
        };
    }

    /**
     * Creates an instance of an initial cameras estimator using provided
     * fundamental matrix and provided method.
     *
     * @param fundamentalMatrix fundamental matrix relating two views.
     * @param method            method to estimate initial cameras.
     * @return an estimator.
     */
    public static InitialCamerasEstimator create(
            final FundamentalMatrix fundamentalMatrix, final InitialCamerasEstimatorMethod method) {
<span class="fc bfc" id="L226" title="All 3 branches covered.">        return switch (method) {</span>
<span class="fc" id="L227">            case ESSENTIAL_MATRIX -&gt; new EssentialMatrixInitialCamerasEstimator(fundamentalMatrix);</span>
<span class="fc" id="L228">            case DUAL_IMAGE_OF_ABSOLUTE_CONIC -&gt; new DualImageOfAbsoluteConicInitialCamerasEstimator(fundamentalMatrix);</span>
<span class="fc" id="L229">            default -&gt; new DualAbsoluteQuadricInitialCamerasEstimator(fundamentalMatrix);</span>
        };
    }

    /**
     * Creates an instance of an initial cameras estimator using provided
     * listener and method.
     *
     * @param listener listener to handle events.
     * @param method   method to estimate initial cameras.
     * @return an estimator.
     */
    public static InitialCamerasEstimator create(
            final InitialCamerasEstimatorListener listener, final InitialCamerasEstimatorMethod method) {
<span class="fc bfc" id="L243" title="All 3 branches covered.">        return switch (method) {</span>
<span class="fc" id="L244">            case ESSENTIAL_MATRIX -&gt; new EssentialMatrixInitialCamerasEstimator(listener);</span>
<span class="fc" id="L245">            case DUAL_IMAGE_OF_ABSOLUTE_CONIC -&gt; new DualImageOfAbsoluteConicInitialCamerasEstimator(listener);</span>
<span class="fc" id="L246">            default -&gt; new DualAbsoluteQuadricInitialCamerasEstimator(listener);</span>
        };
    }

    /**
     * Creates an instance of an initial cameras estimator using provided
     * fundamental matrix, listener and method.
     *
     * @param fundamentalMatrix fundamental matrix relating two views.
     * @param listener          listener to handle events.
     * @param method            method to estimate initial cameras.
     * @return an estimator.
     */
    public static InitialCamerasEstimator create(
            final FundamentalMatrix fundamentalMatrix,
            final InitialCamerasEstimatorListener listener,
            final InitialCamerasEstimatorMethod method) {
<span class="fc bfc" id="L263" title="All 3 branches covered.">        return switch (method) {</span>
<span class="fc" id="L264">            case ESSENTIAL_MATRIX -&gt; new EssentialMatrixInitialCamerasEstimator(fundamentalMatrix, listener);</span>
<span class="fc" id="L265">            case DUAL_IMAGE_OF_ABSOLUTE_CONIC -&gt; new DualImageOfAbsoluteConicInitialCamerasEstimator(</span>
                    fundamentalMatrix, listener);
<span class="fc" id="L267">            default -&gt; new DualAbsoluteQuadricInitialCamerasEstimator(fundamentalMatrix, listener);</span>
        };
    }

    /**
     * Creates an instance of an initial cameras estimator using provided
     * method.
     *
     * @return an estimator.
     */
    public static InitialCamerasEstimator create() {
<span class="fc" id="L278">        return create(DEFAULT_METHOD);</span>
    }

    /**
     * Creates an instance of an initial cameras estimator using provided
     * fundamental matrix and provided method.
     *
     * @param fundamentalMatrix fundamental matrix relating two views.
     * @return an estimator.
     */
    public static InitialCamerasEstimator create(final FundamentalMatrix fundamentalMatrix) {
<span class="fc" id="L289">        return create(fundamentalMatrix, DEFAULT_METHOD);</span>
    }

    /**
     * Creates an instance of an initial cameras estimator using provided
     * listener and method.
     *
     * @param listener listener to handle events.
     * @return an estimator.
     */
    public static InitialCamerasEstimator create(final InitialCamerasEstimatorListener listener) {
<span class="fc" id="L300">        return create(listener, DEFAULT_METHOD);</span>
    }

    /**
     * Creates an instance of an initial cameras estimator using provided
     * fundamental matrix, listener and method.
     *
     * @param fundamentalMatrix fundamental matrix relating two views.
     * @param listener          listener to handle events.
     * @return an estimator.
     */
    public static InitialCamerasEstimator create(
            final FundamentalMatrix fundamentalMatrix, final InitialCamerasEstimatorListener listener) {
<span class="fc" id="L313">        return create(fundamentalMatrix, listener, DEFAULT_METHOD);</span>
    }
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.13.202504020838</span></div></body></html>