<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>SinglePoint3DTriangulator.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">com.irurueta:irurueta-ar</a> &gt; <a href="index.source.html" class="el_package">com.irurueta.ar.sfm</a> &gt; <span class="el_source">SinglePoint3DTriangulator.java</span></div><h1>SinglePoint3DTriangulator.java</h1><pre class="source lang-java linenums">/*
 * Copyright (C) 2015 Alberto Irurueta Carro (alberto@irurueta.com)
 *
 * Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *         http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
package com.irurueta.ar.sfm;

import com.irurueta.geometry.CoordinatesType;
import com.irurueta.geometry.PinholeCamera;
import com.irurueta.geometry.Point2D;
import com.irurueta.geometry.Point3D;
import com.irurueta.geometry.estimators.LockedException;
import com.irurueta.geometry.estimators.NotReadyException;

import java.util.List;

/**
 * Base class to triangulate matched 2D points into a single 3D one by using
 * 2D points correspondences on different views along with the corresponding
 * cameras on each of those views.
 * Subclasses will implement different types of triangulators that can provide
 * either LMSE or weighted solutions using either homogeneous or inhomogeneous
 * systems of equations.
 * Inhomogeneous methods are suitable only for cases where finite points and
 * cameras are being used. If points or cameras are located very far or at
 * infinity, triangulation will fail when using inhomogeneous methods.
 * Homogeneous methods are suitable for any case, however, if points and
 * cameras are close and well-defined, inhomogeneous methods might yield better
 * accuracy (although the difference is minimal).
 */
public abstract class SinglePoint3DTriangulator {

    /**
     * Default triangulator type.
     */
<span class="fc" id="L46">    public static final Point3DTriangulatorType DEFAULT_TYPE = Point3DTriangulatorType.LMSE_HOMOGENEOUS_TRIANGULATOR;</span>

    /**
     * Minimum required number of views to triangulate 3D points.
     */
    public static final int MIN_REQUIRED_VIEWS = 2;

    /**
     * Matched 2D points. Each point in the list is assumed to be projected by
     * the corresponding camera in the list.
     */
    protected List&lt;Point2D&gt; points2D;

    /**
     * List of cameras associated to the matched 2D point on the same position
     * as the camera on the list.
     */
    protected List&lt;PinholeCamera&gt; cameras;

    /**
     * Listener to handle events generated by instances of this class.
     */
    protected SinglePoint3DTriangulatorListener listener;

    /**
     * Indicates whether this instance is locked doing computations.
     */
    protected boolean locked;

    /**
     * Constructor.
     */
<span class="fc" id="L78">    protected SinglePoint3DTriangulator() {</span>
<span class="fc" id="L79">    }</span>

    /**
     * Constructor.
     *
     * @param points2D list of matched 2D points on each view. Each point in the
     *                 list is assumed to be projected by the corresponding camera in the list.
     * @param cameras  camera for each view where 2D points are represented.
     * @throws IllegalArgumentException if provided lists don't have the same
     *                                  length or their length is less than 2 views, which is the minimum
     *                                  required to compute triangulation.
     */
<span class="fc" id="L91">    protected SinglePoint3DTriangulator(final List&lt;Point2D&gt; points2D, final List&lt;PinholeCamera&gt; cameras) {</span>
<span class="fc" id="L92">        internalSetPointsAndCameras(points2D, cameras);</span>
<span class="fc" id="L93">    }</span>

    /**
     * Constructor.
     *
     * @param listener listener to notify events generated by instances of this
     *                 class.
     */
<span class="fc" id="L101">    protected SinglePoint3DTriangulator(final SinglePoint3DTriangulatorListener listener) {</span>
<span class="fc" id="L102">        this.listener = listener;</span>
<span class="fc" id="L103">    }</span>

    /**
     * Constructor.
     *
     * @param points2D list of matched 2D points on each view. Each point in the
     *                 list is assumed to be projected by the corresponding camera in the list.
     * @param cameras  cameras for each view where 2D points are represented.
     * @param listener listener to notify events generated by instances of this
     *                 class.
     * @throws IllegalArgumentException if provided lists don't have the same
     *                                  length or their length is less than 2 views, which is the minimum
     *                                  required to compute triangulation.
     */
    protected SinglePoint3DTriangulator(final List&lt;Point2D&gt; points2D, final List&lt;PinholeCamera&gt; cameras,
                                        final SinglePoint3DTriangulatorListener listener) {
<span class="fc" id="L119">        this(points2D, cameras);</span>
<span class="fc" id="L120">        this.listener = listener;</span>
<span class="fc" id="L121">    }</span>

    /**
     * Returns list of matched 2D points on each view. Each point in the list is
     * assumed to be projected by the corresponding camera.
     *
     * @return list of matched 2D points on each view.
     */
    public List&lt;Point2D&gt; getPoints2D() {
<span class="fc" id="L130">        return points2D;</span>
    }

    /**
     * Returns cameras for each view where 2D points are represented.
     *
     * @return cameras for each view where 2D points are represented.
     */
    public List&lt;PinholeCamera&gt; getCameras() {
<span class="fc" id="L139">        return cameras;</span>
    }

    /**
     * Sets list of matched 2D points for each view and their corresponding
     * cameras used to project them.
     *
     * @param points2D list of matched 2D points on each view. Each point in the
     *                 list is assumed to be projected by the corresponding camera in the list.
     * @param cameras  cameras for each view where 2D points are represented.
     * @throws LockedException          if this instance is locked.
     * @throws IllegalArgumentException if provided lists don't have the same
     *                                  length or their length is less than 2 views, which is the minimum
     *                                  required to compute triangulation.
     */
    public void setPointsAndCameras(final List&lt;Point2D&gt; points2D, final List&lt;PinholeCamera&gt; cameras)
            throws LockedException {
<span class="fc bfc" id="L156" title="All 2 branches covered.">        if (isLocked()) {</span>
<span class="fc" id="L157">            throw new LockedException();</span>
        }
<span class="fc" id="L159">        internalSetPointsAndCameras(points2D, cameras);</span>
<span class="fc" id="L160">    }</span>

    /**
     * Indicates whether this instance is locked because computations are being
     * done.
     *
     * @return true if instance is locked, false otherwise.
     */
    public boolean isLocked() {
<span class="fc" id="L169">        return locked;</span>
    }

    /**
     * Indicates whether this instance is ready to start the triangulation.
     * An instance is ready when both lists of 2D points and cameras are
     * provided, both lists have the same length and at least data for 2 views
     * is provided.
     *
     * @return true if this instance is ready, false otherwise.
     */
    public boolean isReady() {
<span class="fc" id="L181">        return areValidPointsAndCameras(points2D, cameras);</span>
    }

    /**
     * Returns listener to be notified of events generated by instances of this
     * class.
     *
     * @return listener to be notified of events generated by instances of this
     * class.
     */
    public SinglePoint3DTriangulatorListener getListener() {
<span class="fc" id="L192">        return listener;</span>
    }

    /**
     * Sets listener to be notified of events generated by instances of this
     * class.
     *
     * @param listener listener to be notified of events generated by instances
     *                 of this class.
     * @throws LockedException if this instance is locked.
     */
    public void setListener(final SinglePoint3DTriangulatorListener listener) throws LockedException {
<span class="fc bfc" id="L204" title="All 2 branches covered.">        if (isLocked()) {</span>
<span class="fc" id="L205">            throw new LockedException();</span>
        }

<span class="fc" id="L208">        this.listener = listener;</span>
<span class="fc" id="L209">    }</span>

    /**
     * Triangulates provided matched 2D points being projected by each
     * corresponding camera into a single 3D point.
     * At least 2 matched 2D points and their corresponding 2 cameras are
     * required to compute triangulation. If more views are provided, an
     * averaged solution can be found.
     *
     * @return computed triangulated 3D point.
     * @throws LockedException               if this instance is locked.
     * @throws NotReadyException             if lists of points and cameras don't have the
     *                                       same length or less than 2 views are provided.
     * @throws Point3DTriangulationException if triangulation fails for some
     *                                       other reason (i.e. degenerate geometry, numerical
     *                                       instabilities, etc.).
     */
    public Point3D triangulate() throws LockedException, NotReadyException, Point3DTriangulationException {
<span class="fc" id="L227">        final var result = Point3D.create(CoordinatesType.HOMOGENEOUS_COORDINATES);</span>
<span class="fc" id="L228">        triangulate(result);</span>
<span class="fc" id="L229">        return result;</span>
    }

    /**
     * Triangulates provided matched 2D points being projected by each
     * corresponding camera into a single 3D point.
     * At least 2 matched 2D points and their corresponding 2 cameras are
     * required to compute triangulation. If more views are provided, an
     * averaged solution can be found.
     *
     * @param result instance where data for triangulated 3D point is stored.
     * @throws LockedException               if this instance is locked.
     * @throws NotReadyException             if lists of points and cameras don't have the
     *                                       same length or less than 2 views are provided.
     * @throws Point3DTriangulationException if triangulation fails for some
     *                                       other reason (i.e. degenerate geometry, numerical
     *                                       instabilities, etc.).
     */
    public void triangulate(final Point3D result) throws LockedException, NotReadyException,
            Point3DTriangulationException {
<span class="fc bfc" id="L249" title="All 2 branches covered.">        if (isLocked()) {</span>
<span class="fc" id="L250">            throw new LockedException();</span>
        }
<span class="pc bpc" id="L252" title="1 of 2 branches missed.">        if (!isReady()) {</span>
<span class="nc" id="L253">            throw new NotReadyException();</span>
        }

<span class="fc" id="L256">        triangulate(points2D, cameras, result);</span>
<span class="fc" id="L257">    }</span>

    /**
     * Indicates whether provided points and cameras are valid to start the
     * triangulation.
     * In order to triangulate points, at least two cameras and their
     * corresponding 2 matched 2D points are required.
     * If more views are provided, an averaged solution can be found.
     *
     * @param points2D list of matched points on each view.
     * @param cameras  cameras for each view where 2D points are represented.
     * @return true if data is enough to start triangulation, false otherwise.
     */
    public static boolean areValidPointsAndCameras(final List&lt;Point2D&gt; points2D, final List&lt;PinholeCamera&gt; cameras) {
<span class="pc bpc" id="L271" title="1 of 6 branches missed.">        return points2D != null &amp;&amp; cameras != null &amp;&amp; points2D.size() == cameras.size()</span>
<span class="fc bfc" id="L272" title="All 2 branches covered.">                &amp;&amp; points2D.size() &gt;= MIN_REQUIRED_VIEWS;</span>
    }

    /**
     * Creates a new 3D point triangulator instance using provided type.
     *
     * @param type a triangulator type.
     * @return a 3D point triangulator instance.
     */
    public static SinglePoint3DTriangulator create(final Point3DTriangulatorType type) {
<span class="fc bfc" id="L282" title="All 4 branches covered.">        return switch (type) {</span>
<span class="fc" id="L283">            case WEIGHTED_INHOMOGENEOUS_TRIANGULATOR -&gt; new WeightedInhomogeneousSinglePoint3DTriangulator();</span>
<span class="fc" id="L284">            case WEIGHTED_HOMOGENEOUS_TRIANGULATOR -&gt; new WeightedHomogeneousSinglePoint3DTriangulator();</span>
<span class="fc" id="L285">            case LMSE_INHOMOGENEOUS_TRIANGULATOR -&gt; new LMSEInhomogeneousSinglePoint3DTriangulator();</span>
<span class="fc" id="L286">            default -&gt; new LMSEHomogeneousSinglePoint3DTriangulator();</span>
        };
    }

    /**
     * Creates a new 3D point triangulator instance using provided lists of
     * points and corresponding cameras along with provided type.
     *
     * @param points2D list of matched 2D points on each view. Each point in the
     *                 list is assumed to be projected by the corresponding camera in the list.
     * @param cameras  camera for each view where 2D points are represented.
     * @param type     a triangulator type.
     * @return a 3D point triangulator instance.
     * @throws IllegalArgumentException if provided lists don't have the same
     *                                  length or their length is less than 2 views, which is the minimum
     *                                  required to compute triangulation.
     */
    public static SinglePoint3DTriangulator create(
            final List&lt;Point2D&gt; points2D, final List&lt;PinholeCamera&gt; cameras, final Point3DTriangulatorType type) {
<span class="fc bfc" id="L305" title="All 4 branches covered.">        return switch (type) {</span>
<span class="fc" id="L306">            case WEIGHTED_INHOMOGENEOUS_TRIANGULATOR -&gt; new WeightedInhomogeneousSinglePoint3DTriangulator(points2D,</span>
                    cameras);
<span class="fc" id="L308">            case WEIGHTED_HOMOGENEOUS_TRIANGULATOR -&gt; new WeightedHomogeneousSinglePoint3DTriangulator(points2D,</span>
                    cameras);
<span class="fc" id="L310">            case LMSE_INHOMOGENEOUS_TRIANGULATOR -&gt; new LMSEInhomogeneousSinglePoint3DTriangulator(points2D,</span>
                    cameras);
<span class="fc" id="L312">            default -&gt; new LMSEHomogeneousSinglePoint3DTriangulator(points2D, cameras);</span>
        };
    }

    /**
     * Creates a new 3D point triangulator instance using provided lists of
     * points, weights and corresponding cameras along with provided type.
     *
     * @param points2D list of matched 2D points on each view. Each point in the
     *                 list is assumed to be projected by the corresponding camera in the list.
     * @param cameras  camera for each view where 2D points are represented.
     * @param weights  weights assigned to each view.
     * @param type     a triangulator type.
     * @return a 3D point triangulator instance.
     * @throws IllegalArgumentException if provided lists or weights don't have
     *                                  the same length or their length is less than 2 views, which is the
     *                                  minimum required to compute triangulation.
     */
    public static SinglePoint3DTriangulator create(
            final List&lt;Point2D&gt; points2D, final List&lt;PinholeCamera&gt; cameras, final double[] weights,
            final Point3DTriangulatorType type) {
<span class="fc bfc" id="L333" title="All 4 branches covered.">        return switch (type) {</span>
<span class="fc" id="L334">            case WEIGHTED_INHOMOGENEOUS_TRIANGULATOR -&gt; new WeightedInhomogeneousSinglePoint3DTriangulator(points2D,</span>
                    cameras, weights);
<span class="fc" id="L336">            case WEIGHTED_HOMOGENEOUS_TRIANGULATOR -&gt; new WeightedHomogeneousSinglePoint3DTriangulator(points2D,</span>
                    cameras, weights);
<span class="fc" id="L338">            case LMSE_INHOMOGENEOUS_TRIANGULATOR -&gt; new LMSEInhomogeneousSinglePoint3DTriangulator(points2D, cameras);</span>
<span class="fc" id="L339">            default -&gt; new LMSEHomogeneousSinglePoint3DTriangulator(points2D, cameras);</span>
        };
    }

    /**
     * Creates a new 3D point triangulator instance using provided listener and
     * type.
     *
     * @param listener listener to notify events generated by instances of this
     *                 class.
     * @param type     a triangulator type.
     * @return a 3D point triangulator instance.
     */
    public static SinglePoint3DTriangulator create(
            final SinglePoint3DTriangulatorListener listener, final Point3DTriangulatorType type) {
<span class="fc bfc" id="L354" title="All 4 branches covered.">        return switch (type) {</span>
<span class="fc" id="L355">            case WEIGHTED_INHOMOGENEOUS_TRIANGULATOR -&gt; new WeightedInhomogeneousSinglePoint3DTriangulator(listener);</span>
<span class="fc" id="L356">            case WEIGHTED_HOMOGENEOUS_TRIANGULATOR -&gt; new WeightedHomogeneousSinglePoint3DTriangulator(listener);</span>
<span class="fc" id="L357">            case LMSE_INHOMOGENEOUS_TRIANGULATOR -&gt; new LMSEInhomogeneousSinglePoint3DTriangulator(listener);</span>
<span class="fc" id="L358">            default -&gt; new LMSEHomogeneousSinglePoint3DTriangulator(listener);</span>
        };
    }

    /**
     * Creates a new 3D point triangulator instance using provided lists of
     * points and corresponding cameras, listener and provided type.
     *
     * @param points2D list of matched 2D points on each view. Each point in the
     *                 list is assumed to be projected by the corresponding camera in the list.
     * @param cameras  camera for each view where 2D points are represented.
     * @param listener listener to notify events generated by instances of this
     *                 class.
     * @param type     a triangulator type.
     * @return a 3D point triangulator instance.
     * @throws IllegalArgumentException if provided lists don't have the same
     *                                  length or their length is less than 2 views, which is the minimum
     *                                  required to compute triangulation.
     */
    public static SinglePoint3DTriangulator create(
            final List&lt;Point2D&gt; points2D, final List&lt;PinholeCamera&gt; cameras,
            final SinglePoint3DTriangulatorListener listener, final Point3DTriangulatorType type) {
<span class="fc bfc" id="L380" title="All 4 branches covered.">        return switch (type) {</span>
<span class="fc" id="L381">            case WEIGHTED_INHOMOGENEOUS_TRIANGULATOR -&gt; new WeightedInhomogeneousSinglePoint3DTriangulator(points2D,</span>
                    cameras, listener);
<span class="fc" id="L383">            case WEIGHTED_HOMOGENEOUS_TRIANGULATOR -&gt; new WeightedHomogeneousSinglePoint3DTriangulator(points2D,</span>
                    cameras, listener);
<span class="fc" id="L385">            case LMSE_INHOMOGENEOUS_TRIANGULATOR -&gt; new LMSEInhomogeneousSinglePoint3DTriangulator(points2D, cameras,</span>
                    listener);
<span class="fc" id="L387">            default -&gt; new LMSEHomogeneousSinglePoint3DTriangulator(points2D, cameras, listener);</span>
        };
    }

    /**
     * Creates a new 3D point triangulator instance using provided lists of
     * points, weights, corresponding cameras, listener and provided type.
     *
     * @param points2D list of matched 2D points on each view. Each point in the
     *                 list is assumed to be projected by the corresponding camera in the list.
     * @param cameras  camera for each view where 2D points are represented.
     * @param weights  weights assigned to each view.
     * @param listener listener to notify events generated by instances of this
     *                 class.
     * @param type     a triangulator type.
     * @return a 3D point triangulator instance.
     * @throws IllegalArgumentException if provided lists or weights don't have
     *                                  the same length or their length is less than 2 views, which is the
     *                                  minimum required to compute triangulation.
     */
    public static SinglePoint3DTriangulator create(
            final List&lt;Point2D&gt; points2D, final List&lt;PinholeCamera&gt; cameras, final double[] weights,
            final SinglePoint3DTriangulatorListener listener, final Point3DTriangulatorType type) {
<span class="fc bfc" id="L410" title="All 4 branches covered.">        return switch (type) {</span>
<span class="fc" id="L411">            case WEIGHTED_INHOMOGENEOUS_TRIANGULATOR -&gt; new WeightedInhomogeneousSinglePoint3DTriangulator(points2D,</span>
                    cameras, weights, listener);
<span class="fc" id="L413">            case WEIGHTED_HOMOGENEOUS_TRIANGULATOR -&gt; new WeightedHomogeneousSinglePoint3DTriangulator(points2D,</span>
                    cameras, weights, listener);
<span class="fc" id="L415">            case LMSE_INHOMOGENEOUS_TRIANGULATOR -&gt; new LMSEInhomogeneousSinglePoint3DTriangulator(points2D, cameras,</span>
                    listener);
<span class="fc" id="L417">            default -&gt; new LMSEHomogeneousSinglePoint3DTriangulator(points2D, cameras, listener);</span>
        };
    }

    /**
     * Creates a new 3D point triangulator instance using default type.
     *
     * @return a 3D point triangulator instance.
     */
    public static SinglePoint3DTriangulator create() {
<span class="fc" id="L427">        return create(DEFAULT_TYPE);</span>
    }

    /**
     * Creates a new 3D point triangulator instance using provided lists of
     * points and corresponding cameras along with default type.
     *
     * @param points2D list of matched 2D points on each view. Each point in the
     *                 list is assumed to be projected by the corresponding camera in the list.
     * @param cameras  camera for each view where 2D points are represented.
     * @return a 3D point triangulator instance.
     * @throws IllegalArgumentException if provided lists don't have the same
     *                                  length or their length is less than 2 views, which is the minimum
     *                                  required to compute triangulation.
     */
    public static SinglePoint3DTriangulator create(final List&lt;Point2D&gt; points2D, final List&lt;PinholeCamera&gt; cameras) {
<span class="fc" id="L443">        return create(points2D, cameras, DEFAULT_TYPE);</span>
    }

    /**
     * Creates a new 3D point triangulator instance using provided lists of
     * points, weights and corresponding cameras along with default type.
     *
     * @param points2D list of matched 2D points on each view. Each point in the
     *                 list is assumed to be projected by the corresponding camera in the list.
     * @param cameras  camera for each view where 2D points are represented.
     * @param weights  weights assigned to each view.
     * @return a 3D point triangulator instance.
     * @throws IllegalArgumentException if provided lists or weights don't have
     *                                  the same length or their length is less than 2 views, which is the
     *                                  minimum required to compute triangulation.
     */
    public static SinglePoint3DTriangulator create(
            final List&lt;Point2D&gt; points2D, final List&lt;PinholeCamera&gt; cameras, double[] weights) {
<span class="fc" id="L461">        return create(points2D, cameras, weights, DEFAULT_TYPE);</span>
    }

    /**
     * Creates a new 3D point triangulator instance using provided listener and
     * default type.
     *
     * @param listener listener to notify events generated by instances of this
     *                 class.
     * @return a 3D point triangulator instance.
     */
    public static SinglePoint3DTriangulator create(final SinglePoint3DTriangulatorListener listener) {
<span class="fc" id="L473">        return create(listener, DEFAULT_TYPE);</span>
    }

    /**
     * Creates a new 3D point triangulator instance using provided lists of
     * points and corresponding cameras, listener and default type.
     *
     * @param points2D list of matched 2D points on each view. Each point in the
     *                 list is assumed to be projected by the corresponding camera in the list.
     * @param cameras  camera for each view where 2D points are represented.
     * @param listener listener to notify events generated by instances of this
     *                 class.
     * @return a 3D point triangulator instance.
     * @throws IllegalArgumentException if provided lists don't have the same
     *                                  length or their length is less than 2 views, which is the minimum
     *                                  required to compute triangulation.
     */
    public static SinglePoint3DTriangulator create(
            final List&lt;Point2D&gt; points2D, final List&lt;PinholeCamera&gt; cameras,
            final SinglePoint3DTriangulatorListener listener) {
<span class="fc" id="L493">        return create(points2D, cameras, listener, DEFAULT_TYPE);</span>
    }

    /**
     * Creates a new 3D point triangulator instance using provided lists of
     * points, weights, corresponding cameras, listener and default type.
     *
     * @param points2D list of matched 2D points on each view. Each point in the
     *                 list is assumed to be projected by the corresponding camera in the list.
     * @param cameras  camera for each view where 2D points are represented.
     * @param weights  weights assigned to each view.
     * @param listener listener to notify events generated by instances of this
     *                 class.
     * @return a 3D point triangulator instance.
     * @throws IllegalArgumentException if provided lists or weights don't have
     *                                  the same length or their length is less than 2 views, which is the
     *                                  minimum required to compute triangulation.
     */
    public static SinglePoint3DTriangulator create(final List&lt;Point2D&gt; points2D,
                                                   final List&lt;PinholeCamera&gt; cameras,
                                                   final double[] weights,
                                                   final SinglePoint3DTriangulatorListener listener) {
<span class="fc" id="L515">        return create(points2D, cameras, weights, listener, DEFAULT_TYPE);</span>
    }

    /**
     * Returns type of triangulator (a combination of homogeneous or
     * inhomogeneous type along with an LMSE or weighted strategy).
     *
     * @return type of triangulator.
     */
    public abstract Point3DTriangulatorType getType();

    /**
     * Internal method to triangulate provided matched 2D points being projected
     * by each corresponding camera into a single 3D point.
     * At least 2 matched 2D points and their corresponding 2 cameras are
     * required to compute triangulation. If more views are provided, an
     * averaged solution is found.
     * This method does not check whether instance is locked or ready.
     *
     * @param points2D matched 2D points. Each point in the list is assumed to
     *                 be projected by the corresponding camera in the list.
     * @param cameras  list of cameras associated to the matched 2D point on the
     *                 same position as the camera on the list.
     * @param result   instance where triangulated 3D point is stored.
     * @throws Point3DTriangulationException if triangulation fails for some
     *                                       other reason (i.e. degenerate geometry, numerical
     *                                       instabilities, etc.).
     */
    protected abstract void triangulate(
            final List&lt;Point2D&gt; points2D, final List&lt;PinholeCamera&gt; cameras, final Point3D result)
            throws Point3DTriangulationException;

    /**
     * Internal method to sets list of matched 2D points for each view and their
     * corresponding cameras used to project them.
     * This method does not check whether instance is locked.
     *
     * @param points2D list of matched 2D points on each view. Each point in the
     *                 list is assumed to be projected by the corresponding camera in the list.
     * @param cameras  cameras for each view where 2D points are represented.
     * @throws IllegalArgumentException if provided lists don't have the same
     *                                  length or their length is less than 2 views, which is the minimum
     *                                  required to compute triangulation.
     */
    private void internalSetPointsAndCameras(final List&lt;Point2D&gt; points2D, final List&lt;PinholeCamera&gt; cameras) {
<span class="fc bfc" id="L560" title="All 2 branches covered.">        if (!areValidPointsAndCameras(points2D, cameras)) {</span>
<span class="fc" id="L561">            throw new IllegalArgumentException();</span>
        }

<span class="fc" id="L564">        this.points2D = points2D;</span>
<span class="fc" id="L565">        this.cameras = cameras;</span>
<span class="fc" id="L566">    }</span>
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.13.202504020838</span></div></body></html>